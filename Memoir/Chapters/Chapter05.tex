%************************************************
\chapter{Implementación}
\label{ch:impl}
%************************************************

En este capítulo se detalla todo el proceso llevado a cabo para el desarrollo
del proyecto, desde la planificación hasta la finalización del mismo. La
implementación del algoritmo se ha realizado en \textsc{Scala}, los detalles del
mismo pueden encontrarse en \autoref{ch:algorithm}. Así mismo, las ventajas del
desarrollo en \textsc{scala} pueden consultarse en el \autoref{ch:scalaintro}.

\section{Planificación}
\label{sec:planning}

En la \autoref{fig:planning} se muestra un diagrama de \emph{Gantt} con la
planificación ideada para el proyecto

\begin{figure}[ht]
  \definecolor{barblue}{RGB}{153,204,254}
  \definecolor{groupblue}{RGB}{51,102,254}
  \definecolor{linkred}{RGB}{165,0,33}
  \renewcommand\sfdefault{phv}
  \renewcommand\mddefault{mc}
  \renewcommand\bfdefault{bc}
  \setganttlinklabel{s-s}{START-TO-START}
  \setganttlinklabel{f-s}{FINISH-TO-START}
  \setganttlinklabel{f-f}{FINISH-TO-FINISH}
\begin{ganttchart}[
  canvas/.append style={fill=none, draw=black!5, line width=.75pt},
  hgrid style/.style={draw=black!5, line width=.75pt},
  vgrid={*1{draw=black!5, line width=.75pt}},
  today=14,
  today rule/.style={
    draw=black!64,
    dash pattern=on 3.5pt off 4.5pt,
    line width=1.5pt
  },
  today label font=\small\scshape,
  title/.style={draw=none, fill=none},
  title label font=\scshape\footnotesize,
  title label node/.append style={below=7pt},
  include title in canvas=false,
  bar label font=\mdseries\small\color{black!70},
  bar label node/.append style={left=2cm},
  bar/.append style={draw=none, fill=black!63},
  bar incomplete/.append style={fill=barblue},
  bar progress label font=\mdseries\footnotesize\color{black!70},
  group incomplete/.append style={fill=groupblue},
    group left shift=0,
    group right shift=0,
    group height=.5,
    group peaks tip position=0,
    group label node/.append style={left=.6cm},
    group progress label font=\scshape\small,
    link/.style={-latex, line width=1.5pt, linkred},
    link label font=\scriptsize\scshape,
    link label node/.append style={below left=-2pt and 0pt},
  ]{1}{14}
  \gantttitle{Parseo de Dependencias en Español}{14} \\[grid]
  \gantttitle{\tiny Septiembre}{4}
  \gantttitle{\tiny Octubre}{4} 
  \gantttitle{\tiny Noviembre}{4}
  \gantttitle{\tiny Diciembre}{2}\\
  \gantttitle[
    title label node/.append style={below left=7pt and -3pt}
  ]{Semana:\quad1}{1}
  \gantttitlelist{2,...,14}{1} \\
  \ganttgroup[progress=100]{Progreso}{1}{14} \\
  \ganttbar[
    progress=100,
    name=research
  ]{Investigación}{1}{4} \\
  \ganttbar[
    progress=100,
    name=design
  ]{Análisis y Diseño}{5}{5} \\
  \ganttbar[
    progress=100,
    name=impl
  ]{Implementación}{6}{11} \\
  \ganttbar[
    progress=100,
    name=memoir
  ]{Memoria}{12}{14} \\    
  
  \ganttmilestone{M1: Conocer el campo del NLP}{4}{4}  \\
  \ganttmilestone{M2: Finalizar Código}{11}{11} \\
  \ganttmilestone{M3: Finalización TFG}{14}{14}
  
  \ganttlink[link type=f-s]{research}{design}
  \ganttlink[link type=f-s]{design}{impl}
  \ganttlink[link type=f-s]{impl}{memoir}
\end{ganttchart}
\caption{Planificación del proyecto}
\label{fig:planning}
\end{figure}

\section{Análisis y Diseño}
\label{sec:design}

\tikzumlset{fill package=gray!20, fill class=gray!20}
Los paquetes creados se organizan según la \autoref{fig:packages}.
\begin{figure}[ht]
  \centering
  \begin{tikzpicture}
    \begin{umlpackage}{Core}
      \umlemptypackage{Functional}
    \end{umlpackage}
    \umlemptypackage[right=1cm of Core,anchor=north]{DataStructures}
    \umlemptypackage[right=0.22cm of DataStructures]{Parser}
    \umlemptypackage[right=0.22cm of Parser]{SVM}
    \umlemptypackage[right=0.22cm of SVM]{Utils}
  \end{tikzpicture}
  \caption{Paquetes del proyecto}
  \label{fig:packages}
\end{figure}

En el paquete \textsc{core.functional} se definen algunas estructuras de teoría
de categorías, actualmente solo hay implementada una mónada -- \emph{monads} --.

En \textsc{DataStructures} se definen las estructuras de datos necesarias para
el desarrollo del proyecto, entre otras, aquí se definen las representaciones de
las frases para \emph{training} y \emph{test} vistas en la
\autoref{fig:classdiag}. En el Código~\ref{lst:ds} se listan algunas de las
estructuras más relevantes.
\begin{listing}[ht]
  \begin{scalacode}
    // Información sobre un nodo
    case class Node(lex: String,
                    position: Int,
                    posTag: String,
                    var dependency: Int = -1,
                    var left: Vector[Node],
                    var right: Vector[Node])

    // Encargada de almacenar las características para la SVM
    final case class Vocabulary(positionVocab: Map[Int, Counter],
                                positionTag: Map[Int, Counter],
                                chLVocab: Map[Int, Counter],
                                chLTag: Map[Int, Counter],
                                chRVocab: Map[Int, Counter],
                                chRTag: Map[Int, Counter])
  \end{scalacode}
  \caption{\footnotesize Estructuras de datos más relevantes del paquete
    \textsc{DataStructures}}
  \label{lst:ds}
\end{listing}

\textsc{Parser} es el paquete principal, contiene la implementación del
algoritmo de parseo de dependencias estadístico de \citeauthor{yamada2003}.

\textsc{SVM} encapsula todo lo relacionado con las \acp{SVM}, desde el adaptador
para los datos hasta la configuración y ajuste de parámetros. Lo más relevante
quizá sean los parámetros usados para la \ac{SVM}, se muestran en el
Código~\ref{lst:svmparams}.
\begin{listing}[ht]
  \begin{scalacode}
    object SVMConfig {
      val param = new svm_parameter

      param.svm_type = svm_parameter.C_SVC
      param.kernel_type = svm_parameter.POLY
      param.degree = 2
      param.gamma = 1.0
      param.coef0 = 1.0
      param.cache_size = 4000
      param.eps = 0.001
      param.C = 1.0
      param.shrinking = 1
    }
  \end{scalacode}
  \caption{Parámetros para la \ac{SVM}}
  \label{lst:svmparams}
\end{listing}
Se aprovecha el Código~\ref{lst:svmparams} para comentar los parámetros usados:
\begin{itemize}
\item \scalainline/param.svm_type = svm_parameter.C_SVC/: especifica que el tipo
  de clasificación va a ser multiclase.
\item \scalainline/param.kernel_type = svm_parameter.POLY/: Como se comentó en
  la \autoref{sec:svmintro} el \emph{kernel} será de tipo polinómico, de grado
  2. El \emph{kernel} se define como $(\gamma\cdot u'\cdot v + coef0)^{degree}$,
  cuyos valores pueden consultarse en el código.
\end{itemize}

\textsc{Utils} define algunas constantes, tipos de datos, métodos de lectura
para los datos de \emph{test} y \emph{training} y encapsula los tres tipos de
acciones que puede realizar el parseador. Las acciones se han codificado según
el Código~\ref{lst:actions}.
\begin{listing}[ht]
  \begin{scalacode}
    object Action {

      sealed trait Action

      case object Left extends Action {
        final def value: Int = 0
      }

      case object Shift extends Action {
        final def value: Int = 1
      }

      case object Right extends Action {
        final def value: Int = 2
      }
    }
  \end{scalacode}
  \caption{\footnotesize Codificación de las acciones \textsc{Desplazar,Izquierda,Derecha}}
  \label{lst:actions}
\end{listing}

A continuación se muestra el diagrama de clases completo.

\begin{figure}[ht]
  \centering
  \begin{tikzpicture}
    \umlclass{Accuracy}{}{}
    \umlclass[right=5mm of Accuracy]{DepParsing}{}{}
    \umlnest{DepParsing}{Accuracy}
    \umlclass[right=5mm of DepParsing]{LabeledSentence}{}{}
    \umlassoc{DepParsing}{LabeledSentence}
    \umlclass[right=5mm of LabeledSentence]{Tokens}{}{}
    \umlclass[above right=10mm and 2mm of LabeledSentence.north]{TrainSentence}{}{}
    \umlclass[above=5mm of LabeledSentence,left=5mm of TrainSentence]{TestSentence}{}{}
    \umlVHVinherit{LabeledSentence}{TestSentence}
    \umlVHVinherit{LabeledSentence}{TrainSentence}
    \umlclass[left=5mm of TestSentence]{Node}{}{}
    \umlassoc[mult2=1,mult1=*]{Node}{TestSentence}
    \umlassoc{LabeledSentence}{Tokens}
    \umlclass[below=5mm of DepParsing]{SVMAdapter}{}{}
    \umlassoc{SVMAdapter}{DepParsing}
    \umlclass[left=5mm of SVMAdapter]{SVMProblem}{}{}
    \umlnest{SVMAdapter}{SVMProblem}
    
  \end{tikzpicture}
\end{figure}

\begin{figure}[ht]
  \centering
  
  \begin{tikzpicture}
    \umlsimpleclass[x=0,y=1.5]{Trait TrainSentence}
    \umlsimpleclass[x=4,y=1.5]{Trait TestSentence}

    \umlsimpleclass[x=4,y=0]{Sentence}
    \umlsimpleclass[x=0,y=0]{LabeledSentence}

    \umlVHVinherit{Sentence}{Trait TestSentence}
    \umlVHVinherit{LabeledSentence}{Trait TestSentence}
    \umlinherit[x=0,y=0,anchors=-120 and -120]{LabeledSentence}{Trait TrainSentence}
  \end{tikzpicture}
  \caption{Diagrama de clases para las sentencias}
  \label{fig:classdiag}
\end{figure}


%*****************************************
%*****************************************
%*****************************************
%*****************************************
%*****************************************
